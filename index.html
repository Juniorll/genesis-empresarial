<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√™nesis Empresarial - ATO 1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .transition-all { transition: all 0.3s ease-in-out; }
        .modal-bg { background-color: rgba(0,0,0,0.5); }
        .fade-enter-active, .fade-leave-active { transition: opacity 0.5s; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
        .join-code { letter-spacing: 0.25em; }
        .satisfaction-rating input[type="radio"]:checked+label {
            transform: scale(1.1);
            border-color: #4f46e5;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div id="app" class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
        
        <!-- Cabe√ßalho -->
        <header class="flex justify-between items-center mb-6 pb-4 border-b border-gray-300">
            <div>
                <h1 class="text-3xl font-bold text-gray-900">üöÄ G√™nesis Empresarial</h1>
                <p class="text-gray-600" v-if="teamName">Equipe: <span class="font-semibold">{{ teamName }}</span> <span v-if="isCEO" class="text-indigo-600 font-bold">(Voc√™ √© o CEO)</span></p>
            </div>
            <div class="flex items-center space-x-4">
                <button v-if="playerAuthenticated" @click="logout" title="Sair da sess√£o" class="bg-red-500 text-white font-semibold px-4 py-2 rounded-lg shadow hover:bg-red-600 transition-all">
                    Sair
                </button>
                <button @click="showScoreboard = true" class="bg-indigo-600 text-white font-semibold px-4 py-2 rounded-lg shadow hover:bg-indigo-700 transition-all">
                    üèÜ Placar
                </button>
                 <button @click="showProfessorModal = true" class="bg-gray-700 text-white font-semibold px-4 py-2 rounded-lg shadow hover:bg-gray-800 transition-all">
                    üßë‚Äçüè´
                </button>
            </div>
        </header>

        <!-- Conte√∫do Principal -->
        <main>
            <!-- Tela de Carregamento -->
            <transition name="fade">
                <div v-if="loading" class="text-center py-20">
                    <svg class="animate-spin h-10 w-10 text-indigo-600 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <p class="mt-4 text-lg font-semibold">{{ loadingMessage }}</p>
                </div>
            </transition>

            <!-- Conte√∫do da Atividade -->
            <transition name="fade">
                <div v-if="!loading">
                    
                    <!-- ETAPA 0.1: LOGIN DO JOGADOR -->
                     <section v-if="!playerAuthenticated" class="bg-white p-8 rounded-xl shadow-lg max-w-lg mx-auto">
                        <h2 class="text-2xl font-bold mb-4">Acesso √† Plataforma</h2>
                        <p class="mb-4 text-gray-600 text-sm">Crie seu login para come√ßar ou para continuar de onde parou. Use o mesmo nome e senha para voltar √† sua equipe.</p>
                        <input type="text" v-model="playerNameInput" placeholder="Seu nome" class="w-full p-3 mb-3 border border-gray-300 rounded-lg">
                        <input type="password" v-model="playerPasswordInput" placeholder="Sua senha" class="w-full p-3 mb-3 border border-gray-300 rounded-lg">
                        <button @click="accessPlatform" class="mt-3 w-full bg-indigo-600 text-white font-semibold px-6 py-3 rounded-lg shadow hover:bg-indigo-700 transition-all disabled:bg-indigo-300" :disabled="!playerNameInput.trim() || !playerPasswordInput.trim()">Acessar</button>
                    </section>

                    <!-- ETAPA 0.2: HUB DE EQUIPES -->
                    <section v-if="playerAuthenticated && !teamId" class="bg-white p-8 rounded-xl shadow-lg">
                         <h2 class="text-2xl font-bold mb-4">Bem-vindo(a), {{ playerNameInput }}!</h2>
                        <div class="grid md:grid-cols-2 gap-8">
                            <!-- Criar Equipe -->
                            <div>
                                <h3 class="text-xl font-semibold mb-3">Criar uma Nova Equipe</h3>
                                <p class="mb-4 text-gray-600 text-sm">Se voc√™ √© o primeiro do seu grupo, crie a equipe e compartilhe o c√≥digo com os outros.</p>
                                <input type="text" v-model="teamNameInput" placeholder="Nome da sua nova equipe" class="w-full p-3 border border-gray-300 rounded-lg">
                                <button @click="createTeam" class="mt-3 w-full bg-indigo-600 text-white font-semibold px-6 py-3 rounded-lg shadow hover:bg-indigo-700 transition-all disabled:bg-indigo-300" :disabled="!teamNameInput.trim()">Criar Equipe</button>
                            </div>
                             <!-- Entrar na Equipe -->
                            <div>
                                <h3 class="text-xl font-semibold mb-3">Entrar em uma Equipe</h3>
                                <p class="mb-4 text-gray-600 text-sm">Se sua equipe j√° foi criada, insira o c√≥digo fornecido pelo seu colega.</p>
                                <input type="text" v-model="joinCodeInput" placeholder="C√≥digo da Equipe" class="w-full p-3 mb-3 border border-gray-300 rounded-lg uppercase text-center font-mono text-lg">
                                <button @click="joinTeam" class="mt-3 w-full bg-gray-600 text-white font-semibold px-6 py-3 rounded-lg shadow hover:bg-gray-700 transition-all disabled:bg-gray-400" :disabled="!joinCodeInput.trim()">Entrar na Equipe</button>
                            </div>
                        </div>
                    </section>
                    
                    <div v-if="isLoggedIn">
                        <!-- ETAPA 1: TESTE DE PERFIL -->
                        <section v-if="currentStep === 1" class="bg-white p-8 rounded-xl shadow-lg">
                            <div v-if="!currentUserProfileCompleted">
                                <h2 class="text-2xl font-bold mb-2">ATO 1 - Etapa 1: Autoconhecimento</h2>
                                <p class="mb-6 text-gray-600">Responda √†s perguntas abaixo para descobrir seu perfil profissional. Seja honesto! N√£o h√° respostas certas ou erradas.</p>
                                <div v-if="!userProfile" class="space-y-6">
                                    <div v-for="(question, qIndex) in questions" :key="qIndex" class="p-4 border border-gray-200 rounded-lg">
                                        <p class="font-semibold mb-3">{{ qIndex + 1 }}. {{ question.text }}</p>
                                        <div class="space-y-2">
                                            <label v-for="(option, oIndex) in question.options" :key="oIndex" class="flex items-center p-3 rounded-lg hover:bg-gray-50 cursor-pointer">
                                                <input type="radio" :name="'question-' + qIndex" :value="option.type" v-model="answers[qIndex]" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                                <span class="ml-3 text-gray-700">{{ option.text }}</span>
                                            </label>
                                        </div>
                                    </div>
                                    <button @click="calculateProfile" class="w-full bg-indigo-600 text-white font-semibold px-6 py-3 rounded-lg shadow hover:bg-indigo-700 transition-all disabled:bg-indigo-300" :disabled="answers.includes(null)">Revelar meu Perfil</button>
                                </div>
                                <div v-else class="text-center bg-indigo-50 p-8 rounded-lg">
                                    <h3 class="text-2xl font-bold text-indigo-800">{{ userProfile.name }}</h3>
                                    <p class="text-indigo-600 font-semibold mt-1">{{ userProfile.title }}</p>
                                    <p class="mt-4 text-left">{{ userProfile.description }}</p>
                                    <button @click="confirmProfile" class="mt-6 bg-green-600 text-white font-semibold px-8 py-3 rounded-lg shadow hover:bg-green-700 transition-all">Confirmar Perfil</button>
                                </div>
                            </div>
                            <div v-else class="text-center">
                                <h2 class="text-2xl font-bold mb-2">Aguardando a Equipe</h2>
                                <p class="mb-4 text-gray-600">Compartilhe o c√≥digo da equipe com seus colegas: <strong class="text-indigo-700 p-2 bg-indigo-100 rounded-md">{{ joinCodeDisplay }}</strong></p>
                                <p class="font-semibold mb-3">Analise os perfis da sua equipe √† medida que eles s√£o definidos.</p>
                                <div class="max-w-2xl mx-auto grid md:grid-cols-2 gap-4 bg-gray-50 p-4 rounded-lg">
                                    <div v-for="member in teamMembers" :key="member.id" class="p-4 rounded-lg" :class="member.profile ? 'bg-white shadow' : 'bg-gray-200'">
                                        <h3 class="font-bold text-lg">{{ member.name }}</h3>
                                        <div v-if="member.profile">
                                            <p class="font-semibold text-indigo-600">{{ profiles[member.profile].title }}</p>
                                            <p class="text-xs text-gray-600 mt-2">{{ profiles[member.profile].description }}</p>
                                        </div>
                                        <p v-else class="text-gray-500">Aguardando defini√ß√£o do perfil...</p>
                                    </div>
                                </div>
                                <button v-if="isTeamCreator" @click="advanceToCompanyVoting" class="mt-6 bg-green-600 text-white font-semibold px-8 py-3 rounded-lg shadow hover:bg-green-700 transition-all disabled:bg-green-300" :disabled="!allMembersHaveProfile">
                                    Todos est√£o prontos! Pr√≥xima Etapa
                                </button>
                                 <p v-else class="mt-6 text-gray-600">Aguardando o criador da equipe avan√ßar para a pr√≥xima etapa...</p>
                            </div>
                        </section>

                        <!-- ETAPA 2: VOTA√á√ÉO DO SEGMENTO -->
                        <section v-if="currentStep === 2" class="bg-white p-8 rounded-xl shadow-lg">
                             <h2 class="text-2xl font-bold mb-2">ATO 1 - Etapa 2: A Oportunidade de Mercado</h2>
                             <p class="mb-2 text-gray-600">Sua equipe deve decidir em qual segmento de tecnologia ir√° atuar. Leiam as op√ß√µes, discutam em grupo e votem. A op√ß√£o com mais votos ser√° a escolhida.</p>
                             <p class="text-sm text-amber-800 bg-amber-100 p-3 rounded-lg mb-6"><strong>Aten√ß√£o:</strong> Se houver empate na vota√ß√£o, voc√™s precisar√£o votar novamente, e a equipe perder√° pontos por falta de consenso.</p>

                            <div v-if="!userVotedFor('company')">
                                <div class="grid lg:grid-cols-2 gap-4">
                                    <label v-for="company in companies" :key="company.id" class="flex p-4 rounded-lg border-2 cursor-pointer transition-all" :class="userVote.company === company.id ? 'border-indigo-500 bg-indigo-50' : 'border-gray-200 hover:bg-gray-50'">
                                        <input type="radio" :name="'company-vote'" :value="company.id" v-model="userVote.company" class="h-5 w-5 text-indigo-600 mt-1">
                                        <div class="ml-4">
                                            <h3 class="font-bold text-lg">{{ company.name }}</h3>
                                            <p class="text-sm font-semibold text-gray-600">{{ company.slogan }}</p>
                                            <p class="text-xs text-gray-500 mt-2">{{ company.description }}</p>
                                        </div>
                                    </label>
                                </div>
                                <button @click="submitVote('company')" class="mt-6 w-full bg-indigo-600 text-white font-semibold px-6 py-3 rounded-lg shadow hover:bg-indigo-700" :disabled="!userVote.company">Confirmar Voto</button>
                            </div>
                             <div v-else class="text-center">
                                <h3 class="text-xl font-bold">Voto Confirmado!</h3>
                                <p class="mt-2">Aguardando os outros membros da equipe votarem...</p>
                            </div>
                        </section>

                        <!-- ETAPA 3: VOTA√á√ÉO PARA CEO -->
                        <section v-if="currentStep === 3" class="bg-white p-8 rounded-xl shadow-lg">
                            <h2 class="text-2xl font-bold mb-2">ATO 1 - Etapa 3: Elei√ß√£o do CEO</h2>
                            <p class="mb-2 text-gray-600">Com o segmento de mercado definido, √© hora de eleger o(a) l√≠der que guiar√° a vis√£o da empresa. A vota√ß√£o √© secreta. Vote em quem voc√™ acredita que tem o melhor perfil para ser o CEO.</p>
                             <p class="text-sm text-amber-800 bg-amber-100 p-3 rounded-lg mb-6"><strong>Aten√ß√£o:</strong> Escolhas un√¢nimes recebem mais pontos. Diverg√™ncias e a necessidade de re-vota√ß√£o por falta de maioria resultar√£o em perda de pontos.</p>

                            <div v-if="!userVotedFor('ceo')">
                                <div class="grid md:grid-cols-2 gap-4">
                                    <label v-for="member in teamMembers" :key="member.id" class="flex items-center p-4 rounded-lg border-2 cursor-pointer transition-all" :class="userVote.ceo === member.id ? 'border-indigo-500 bg-indigo-50' : 'border-gray-200 hover:bg-gray-50'">
                                        <input type="radio" :name="'ceo-vote'" :value="member.id" v-model="userVote.ceo" class="h-5 w-5 text-indigo-600">
                                        <div class="ml-4">
                                            <p class="font-bold text-lg">{{ member.name }}</p>
                                            <p class="text-sm text-gray-600">{{ profiles[member.profile]?.name }}</p>
                                        </div>
                                    </label>
                                </div>
                                <button @click="submitVote('ceo')" class="mt-6 w-full bg-indigo-600 text-white font-semibold px-6 py-3 rounded-lg shadow hover:bg-indigo-700" :disabled="!userVote.ceo">Confirmar Voto</button>
                            </div>
                            <div v-else class="text-center">
                                <h3 class="text-xl font-bold">Voto Confirmado!</h3>
                                <p class="mt-2">Aguardando os outros membros da equipe votarem...</p>
                            </div>
                        </section>

                        <!-- ETAPA 3.5: SATISFA√á√ÉO COM CEO -->
                         <section v-if="currentStep === 3.5" class="bg-white p-8 rounded-xl shadow-lg text-center">
                             <h2 class="text-2xl font-bold mb-2">CEO Eleito!</h2>
                             <p class="text-lg mb-6">O(A) novo(a) CEO da equipe √©: <strong class="text-indigo-600">{{ getCeoName() }}</strong></p>
                             <div v-if="!isCEO">
                                <h3 class="font-semibold mb-3">Qual seu n√≠vel de satisfa√ß√£o com esta escolha?</h3>
                                 <div v-if="!userSatisfaction.ceo">
                                    <div class="flex justify-center space-x-2 satisfaction-rating">
                                        <input type="radio" id="s1" class="hidden" v-model="userSatisfactionInput.ceo" value="1"><label for="s1" class="text-3xl cursor-pointer p-2 rounded-full transition-all border-2 border-transparent">üò°</label>
                                        <input type="radio" id="s2" class="hidden" v-model="userSatisfactionInput.ceo" value="2"><label for="s2" class="text-3xl cursor-pointer p-2 rounded-full transition-all border-2 border-transparent">üòï</label>
                                        <input type="radio" id="s3" class="hidden" v-model="userSatisfactionInput.ceo" value="3"><label for="s3" class="text-3xl cursor-pointer p-2 rounded-full transition-all border-2 border-transparent">üòê</label>
                                        <input type="radio" id="s4" class="hidden" v-model="userSatisfactionInput.ceo" value="4"><label for="s4" class="text-3xl cursor-pointer p-2 rounded-full transition-all border-2 border-transparent">üòä</label>
                                        <input type="radio" id="s5" class="hidden" v-model="userSatisfactionInput.ceo" value="5"><label for="s5" class="text-3xl cursor-pointer p-2 rounded-full transition-all border-2 border-transparent">ü§©</label>
                                    </div>
                                    <button @click="submitSatisfaction('ceo')" class="mt-6 bg-indigo-600 text-white font-semibold px-8 py-3 rounded-lg shadow" :disabled="!userSatisfactionInput.ceo">Enviar Avalia√ß√£o</button>
                                </div>
                                <p v-else class="text-gray-600 font-semibold">Sua avalia√ß√£o foi registrada. Aguardando os outros membros...</p>
                             </div>
                             <div v-else>
                                <p class="text-gray-600">Aguarde enquanto sua equipe avalia o resultado da elei√ß√£o...</p>
                                <div v-if="teamSatisfaction.ceo" class="mt-4">
                                    <p class="font-bold">M√©dia de Satisfa√ß√£o da Equipe: <span class="text-2xl" :class="getTeamSatisfactionEmoji('ceo').color">{{ getTeamSatisfactionEmoji('ceo').emoji }}</span></p>
                                </div>
                             </div>
                        </section>
                        
                        <!-- ETAPAS... -->

                    </div>
                </div>
            </transition>
        </main>
        
        <!-- Modal do Placar -->
        <transition name="fade">
            <div v-if="showScoreboard" class="fixed inset-0 z-10 flex items-center justify-center modal-bg" @click="showScoreboard = false">
                <div class="bg-white rounded-xl shadow-2xl p-8 w-full max-w-2xl" @click.stop>
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold">üèÜ Placar em Tempo Real</h2>
                        <button @click="showScoreboard = false" class="text-gray-500 hover:text-gray-800">&times;</button>
                    </div>
                    <div class="space-y-4">
                        <div v-for="team in sortedTeams" :key="team.id" class="flex items-center justify-between p-4 rounded-lg" :class="team.id === teamId ? 'bg-indigo-100' : 'bg-gray-100'">
                            <span class="font-bold text-lg">{{ team.name }}</span>
                            <span class="font-bold text-xl text-indigo-600">{{ scoresVisible ? team.score : '???' }}</span>
                        </div>
                        <div v-if="!scoresVisible" class="text-center text-gray-500 pt-4">
                            As pontua√ß√µes ser√£o reveladas pelo professor...
                        </div>
                    </div>
                </div>
            </div>
        </transition>

         <!-- Modal do Professor -->
        <transition name="fade">
            <div v-if="showProfessorModal" class="fixed inset-0 z-20 flex items-center justify-center modal-bg" @click="showProfessorModal = false">
                <div class="bg-white rounded-xl shadow-2xl p-8 w-full max-w-sm" @click.stop>
                     <h2 class="text-2xl font-bold text-center mb-4">Modo Professor</h2>
                    <div v-if="!isProfessor">
                        <label for="prof-pass" class="block font-semibold mb-2">Senha:</label>
                        <input type="password" id="prof-pass" v-model="professorPassword" @keyup.enter="enterProfessorMode" class="w-full p-2 border border-gray-300 rounded-lg mb-4">
                        <button @click="enterProfessorMode" class="w-full bg-gray-700 text-white font-semibold py-2 rounded-lg hover:bg-gray-800">Entrar</button>
                    </div>
                    <div v-else class="text-center space-y-4">
                        <p class="text-green-600 font-semibold">Autenticado com sucesso!</p>
                        <button @click="toggleScoresVisibility" class="w-full bg-indigo-600 text-white font-semibold py-2 rounded-lg hover:bg-indigo-700">
                            {{ scoresVisible ? 'Ocultar Pontua√ß√µes' : 'Revelar Pontua√ß√µes' }}
                        </button>
                         <button @click="confirmResetGame" class="w-full bg-red-600 text-white font-semibold py-2 rounded-lg hover:bg-red-700">
                            Zerar Jogo
                        </button>
                        <button @click="logoutProfessor" class="w-full text-sm text-gray-600 hover:underline">Sair do Modo Professor</button>
                    </div>
                </div>
            </div>
        </transition>

    </div>

    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, collection, onSnapshot, updateDoc, addDoc, query, where, getDocs, arrayUnion, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- FIREBASE CONFIG (WILL BE PROVIDED BY THE ENVIRONMENT) ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'genesis-empresarial-dev';
        const firebaseConfig = {
          apiKey: "AIzaSyDFx4jZDjnsEmOSFUXW3NykN0hPSTBL7Lc",
          authDomain: "genesis-empresarial-87b1d.firebaseapp.com",
          projectId: "genesis-empresarial-87b1d",
          storageBucket: "genesis-empresarial-87b1d.firebasestorage.app",
          messagingSenderId: "41214218923",
          appId: "1:41214218923:web:4b77d3930b61f423dbddee",
          measurementId: "G-S68YFP7JHC"
        };
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // --- FIREBASE INITIALIZATION ---
        let app, auth, db;
        
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
        } catch (e) {
            console.error("Firebase initialization failed:", e);
            // Handle initialization error in the UI if needed
        }


        const { createApp, ref, reactive, computed, onMounted, watch } = Vue

        createApp({
            setup() {
                // Estado da Aplica√ß√£o
                const loading = ref(true);
                const loadingMessage = ref('Conectando ao servidor...');
                const connected = ref(false);
                const connectionMessage = ref('');
                const playerAuthenticated = ref(false);
                const teamId = ref(null);
                const currentStep = ref(0);
                const userId = ref(null);
                const teamName = ref('');
                const teamNameInput = ref('');
                const playerNameInput = ref('');
                const playerPasswordInput = ref('');
                const joinCodeInput = ref('');
                const joinCodeDisplay = ref('');
                let teamListener = null;

                const isLoggedIn = computed(() => playerAuthenticated.value && !!teamId.value);


                // Dados da Atividade
                const questions = reactive([
                    { text: "Diante de um grande projeto novo, sua primeira rea√ß√£o √©:", options: [{text: "Planejar cada detalhe antes de come√ßar.", type: "Analista"},{text: "Juntar a equipe para um brainstorming de ideias malucas.", type: "Inovador"},{text: "Come√ßar a construir um prot√≥tipo imediatamente.", type: "Executor"},{text: "Conversar com as pessoas para entender o que elas precisam.", type: "Comunicador"}]},
                    { text: "Qual ambiente de trabalho te deixa mais produtivo?", options: [{text: "Um lugar quieto, com dados e gr√°ficos para analisar.", type: "Analista"},{text: "Uma sala cheia de quadros brancos, post-its e liberdade para criar.", type: "Inovador"},{text: "Qualquer lugar onde eu possa colocar a m√£o na massa e ver resultados.", type: "Executor"},{text: "Um ambiente colaborativo, cheio de reuni√µes e conversas.", type: "Comunicador"}]},
                    { text: "Um cliente reporta um problema inesperado. O que voc√™ faz?", options: [{text: "Investigo a causa raiz do problema sistematicamente.", type: "Analista"},{text: "Penso em tr√™s solu√ß√µes completamente novas para resolver e encantar.", type: "Inovador"},{text: "Aplico uma corre√ß√£o r√°pida para resolver o agora, e depois melhoro.", type: "Executor"},{text: "Ligo para o cliente, ou√ßo com aten√ß√£o e garanto que ele se sinta compreendido.", type: "Comunicador"}]},
                    { text: "Como voc√™ prefere aprender algo novo?", options: [{text: "Lendo a documenta√ß√£o completa e fazendo anota√ß√µes.", type: "Analista"},{text: "Assistindo a v√≠deos inspiradores e experimentando sem medo de errar.", type: "Inovador"},{text: "Seguindo um tutorial pr√°tico, passo a passo.", type: "Executor"},{text: "Participando de um workshop em grupo e discutindo com colegas.", type: "Comunicador"}]},
                    { text: "O que √© mais importante para o sucesso de uma empresa?", options: [{text: "Processos eficientes e decis√µes baseadas em dados.", type: "Analista"},{text: "Uma vis√£o de futuro ousada e capacidade de se reinventar.", type: "Inovador"},{text: "Entregar resultados de forma r√°pida e consistente.", type: "Executor"},{text: "Uma cultura forte e um bom relacionamento com clientes e equipe.", type: "Comunicador"}]},
                    { text: "Quando um projeto em que voc√™ trabalhou intensamente falha, sua rea√ß√£o √©:", options: [{text: "Analisar o que deu errado para criar um relat√≥rio de li√ß√µes aprendidas.", type: "Analista"},{text: "Ver o fracasso como uma oportunidade de pivotar para uma ideia ainda melhor.", type: "Inovador"},{text: "Come√ßar a trabalhar imediatamente em uma nova vers√£o, corrigindo os erros.", type: "Executor"},{text: "Reunir a equipe para levantar o moral e discutir o que aprenderam juntos.", type: "Comunicador"}]},
                    { text: "Voc√™ precisa apresentar sua ideia para investidores. Qual sua abordagem?", options: [{text: "Um pitch deck recheado de dados de mercado, proje√ß√µes financeiras e KPIs.", type: "Analista"},{text: "Uma apresenta√ß√£o vision√°ria, focada na hist√≥ria e no potencial transformador da ideia.", type: "Inovador"},{text: "Uma demonstra√ß√£o ao vivo do prot√≥tipo, mostrando o que j√° funciona.", type: "Executor"},{text: "Focar em construir um relacionamento com os investidores, entendendo suas dores e vis√µes.", type: "Comunicador"}]},
                    { text: "O que te d√° mais satisfa√ß√£o?", options: [{text: "Resolver um problema complexo que ningu√©m mais conseguiu.", type: "Analista"},{text: "Ter uma ideia que muda completamente as regras do jogo.", type: "Inovador"},{text: "Entregar um projeto no prazo e ver as pessoas usando o produto.", type: "Executor"},{text: "Receber um feedback positivo de um cliente ou colega de equipe.", type: "Comunicador"}]},
                    { text: "Como voc√™ lida com feedback sobre seu trabalho?", options: [{text: "Agrade√ßo e pe√ßo dados ou exemplos espec√≠ficos para entender a fundo.", type: "Analista"},{text: "Uso o feedback como combust√≠vel para ter ideias ainda mais criativas.", type: "Inovador"},{text: "Agrade√ßo e j√° come√ßo a implementar as mudan√ßas sugeridas.", type: "Executor"},{text: "Inicio uma conversa para entender a perspectiva da pessoa e o sentimento por tr√°s do feedback.", type: "Comunicador"}]},
                    { text: "Em uma equipe, qual papel voc√™ naturalmente assume?", options: [{text: "O que organiza os processos e garante que nada seja esquecido.", type: "Analista"},{text: "O que traz novas perspectivas e desafia o status quo.", type: "Inovador"},{text: "O que arrega√ßa as mangas e incentiva todos a focarem na entrega.", type: "Executor"},{text: "O que mant√©m a equipe unida e garante que todos est√£o se comunicando bem.", type: "Comunicador"}]}
                ]);
                const answers = ref(Array(questions.length).fill(null));
                const userProfile = ref(null);
                const profiles = {
                    Analista: { name: "O Arquiteto Analista", title: "A Mente Estrat√©gica", description: "Voc√™ √© met√≥dico, detalhista e brilha ao analisar dados para tomar decis√µes bem-fundamentadas. Sua for√ßa est√° em criar sistemas l√≥gicos, encontrar falhas e garantir a qualidade e a estabilidade. Processos e planejamento s√£o seus melhores amigos." },
                    Inovador: { name: "O Vision√°rio Inovador", title: "A For√ßa Criativa", description: "Voc√™ enxerga al√©m do √≥bvio e adora criar solu√ß√µes disruptivas. Sua mente est√° sempre borbulhando com novas ideias e possibilidades. Voc√™ n√£o tem medo de arriscar e √© apaixonado por construir o futuro, mesmo que o caminho seja incerto." },
                    Executor: { name: "O Realizador Executor", title: "A Pot√™ncia da A√ß√£o", description: "Voc√™ √© pr√°tico, focado e tem uma habilidade incr√≠vel de transformar ideias em realidade. Enquanto outros discutem, voc√™ j√° est√° fazendo. Seu lema √© 'feito √© melhor que perfeito' e voc√™ se motiva ao ver o progresso e entregar resultados concretos." },
                    Comunicador: { name: "O Conector Comunicador", title: "A Alma do Neg√≥cio", description: "Voc√™ entende de pessoas. Sua grande for√ßa √© construir pontes, motivar a equipe, negociar com clientes e criar uma cultura positiva. Voc√™ sabe que a tecnologia s√≥ tem valor quando resolve problemas reais para pessoas reais." }
                };
                
                const userVote = ref({ company: null, ceo: null });
                const userSatisfactionInput = ref({ ceo: null, roles: null, hires: null });

                const companies = reactive([
                    { id: 'Healthtech', name: 'Segmento: Healthtech', slogan: 'Bem-estar na palma da sua m√£o.', description: 'Um aplicativo de sa√∫de mental que oferece medita√ß√µes guiadas, monitoramento de humor e acesso a terapeutas. O mercado exige alta confian√ßa do usu√°rio, design acolhedor e total privacidade dos dados (LGPD).', idealProfiles: ['Comunicador', 'Analista'] },
                    { id: 'Agrotech', name: 'Segmento: Agrotech', slogan: 'A colheita do futuro, hoje.', description: 'Uma plataforma SaaS que usa dados de drones e sensores para monitorar a sa√∫de das planta√ß√µes. O sucesso depende da precis√£o dos dados, efici√™ncia operacional e uma infraestrutura de backend robusta.', idealProfiles: ['Executor', 'Analista'] },
                    { id: 'Martech', name: 'Segmento: Martech', slogan: 'Sua marca, amplificada.', description: 'Uma ferramenta de IA para otimizar e criar conte√∫do para redes sociais. O mercado √© r√°pido e valoriza inova√ß√£o constante, velocidade e uma forte estrat√©gia de marketing para se destacar.', idealProfiles: ['Inovador', 'Comunicador'] },
                    { id: 'Sustentatech', name: 'Segmento: Sustentatech', slogan: 'Crescimento com prop√≥sito.', description: 'Software para empresas (B2B) medirem e relatarem sua pegada de carbono. A confian√ßa nos dados √© crucial, assim como uma abordagem de vendas consultiva para conquistar clientes corporativos.', idealProfiles: ['Analista', 'Executor', 'Comunicador'] },
                    { id: 'Imersivetech', name: 'Segmento: Imersivetech (VR/AR)', slogan: 'Vivendo novas realidades.', description: 'Uma experi√™ncia educacional em Realidade Virtual (VR) que recria s√≠tios hist√≥ricos. O apelo est√° na inova√ß√£o, na qualidade gr√°fica e em uma experi√™ncia de usu√°rio imersiva e sem falhas t√©cnicas.', idealProfiles: ['Inovador', 'Executor'] },
                ]);
                const selectedCompanyForSuggestion = ref(null);
                
                const allRoles = reactive([
                    {id: 'CEO', name: 'Chief Executive Officer', description: 'O l√≠der principal. Define a vis√£o e a estrat√©gia geral da empresa, sendo o rosto da organiza√ß√£o.'},
                    {id: 'CTO', name: 'Chief Technology Officer', description: 'O l√≠der da tecnologia. Supervisiona o desenvolvimento, a infraestrutura e a inova√ß√£o tecnol√≥gica do produto.'},
                    {id: 'COO', name: 'Chief Operating Officer', description: 'O l√≠der das opera√ß√µes. Garante que os processos do dia a dia da empresa funcionem de forma eficiente e produtiva.'},
                    {id: 'CFO', name: 'Chief Financial Officer', description: 'O l√≠der financeiro. Gerencia o capital, o planejamento financeiro e os investimentos da empresa.'},
                    {id: 'CMO', name: 'Chief Marketing Officer', description: 'O l√≠der de marketing. Supervisiona o branding, a publicidade e as estrat√©gias para alcan√ßar novos clientes.'},
                ]);
                const assignedRoles = ref({});
                const teamMembers = ref([]);

                const orcamentoInicial = ref(25000);
                const availableHires = reactive([
                    { role: 'Desenvolvedor S√™nior', description: 'Acelera o desenvolvimento de funcionalidades complexas.', salario: 12000, area: 'CTO' },
                    { role: 'Desenvolvedor J√∫nior', description: 'D√° suporte ao time de tecnologia e aprende r√°pido.', salario: 4000, area: 'CTO' },
                    { role: 'Gerente de Projetos', description: 'Organiza as tarefas e garante os prazos de entrega.', salario: 11000, area: 'COO' },
                    { role: 'Analista de Qualidade (QA)', description: 'Testa o produto para encontrar bugs e garantir a qualidade.', salario: 5000, area: 'CTO' },
                    { role: 'Designer UX/UI', description: 'Cria a experi√™ncia do usu√°rio e o design das telas do aplicativo.', salario: 7000, area: 'CTO' },
                    { role: 'Engenheiro de DevOps', description: 'Cuida da infraestrutura na nuvem e da automa√ß√£o dos deploys.', salario: 13000, area: 'CTO' },
                    { role: 'Cientista de Dados', description: 'Analisa os dados dos usu√°rios para extrair insights e guiar decis√µes.', salario: 10000, area: 'CTO' },
                    { role: 'Social Media', description: 'Gerencia as redes sociais para engajar a comunidade e atrair usu√°rios.', salario: 4500, area: 'CMO' },
                    { role: 'Especialista de Suporte', description: 'Atende os clientes, resolve problemas e coleta feedbacks.', salario: 2500, area: 'COO' },
                    { role: 'Vendedor (SDR)', description: 'Busca ativamente por novos clientes e realiza as primeiras abordagens de venda.', salario: 3500, area: 'CMO' },
                ]);
                const hiredCounts = ref({});
                const suggestions = ref({});
                const userSuggestion = ref({});
                const teamSatisfaction = ref({});
                const finalReport = ref(null);


                // Estado do Placar e Professor
                const showScoreboard = ref(false);
                const allTeams = ref([]);
                const scoresVisible = ref(false);
                const showProfessorModal = ref(false);
                const isProfessor = ref(false);
                const professorPassword = ref('');
                
                // Propriedades Computadas
                const isCEO = computed(() => {
                    if (!userId.value || !assignedRoles.value['CEO']) return false;
                    return userId.value === assignedRoles.value['CEO'];
                });

                const isTeamCreator = computed(() => {
                    if (teamMembers.value.length === 0) return false;
                    return userId.value === teamMembers.value[0].id;
                });

                const allMembersHaveProfile = computed(() => {
                    if (teamMembers.value.length === 0) return false;
                    return teamMembers.value.every(m => m.profile);
                });
                
                const userVotedFor = (voteType) => {
                    return suggestions.value?.votes?.[voteType] && suggestions.value.votes[voteType][userId.value];
                };

                const userSatisfaction = computed(() => {
                    const satisfactionData = suggestions.value?.satisfaction || {};
                    return {
                        ceo: satisfactionData.ceo && satisfactionData.ceo[userId.value],
                        roles: satisfactionData.roles && satisfactionData.roles[userId.value],
                        hires: satisfactionData.hires && satisfactionData.hires[userId.value],
                    };
                });


                const sortedTeams = computed(() => {
                    return [...allTeams.value].sort((a, b) => (b.score || 0) - (a.score || 0));
                });

                const saldoRestanteMensal = computed(() => {
                    const custoTotal = Object.values(hiredCounts.value).reduce((total, hire) => total + (hire.count * hire.salario), 0);
                    return orcamentoInicial.value - custoTotal;
                });

                const availableRoles = computed(() => {
                    if (teamMembers.value.length === 0) return [];
                    const rolesCount = Math.min(teamMembers.value.length, allRoles.length);
                    return allRoles.slice(0, rolesCount);
                });

                const otherRoles = computed(() => {
                    return availableRoles.value.filter(role => role.id !== 'CEO');
                });
                
                const areAllRolesAssigned = computed(() => {
                    if (teamMembers.value.length < 2) return true; // Se s√≥ tem CEO, j√° est√° completo
                    const requiredRoles = availableRoles.value.length;
                    const assignedRoleCount = Object.keys(assignedRoles.value).length;
                    const assignedMemberIds = new Set(Object.values(assignedRoles.value));

                    return assignedRoleCount === requiredRoles && assignedMemberIds.size === teamMembers.value.length;
                });

                const currentUserProfileCompleted = computed(() => {
                    const user = teamMembers.value.find(m => m.id === userId.value);
                    return !!(user && user.profile);
                });
                
                const checkAllVotes = (voteType) => {
                    const votes = suggestions.value?.votes?.[voteType] || {};
                    if (teamMembers.value.length > 0 && Object.keys(votes).length === teamMembers.value.length) {
                         if (isTeamCreator.value) { // Apenas o criador da equipe processa para evitar concorr√™ncia
                            processVoteResults(voteType);
                         }
                    }
                };
                
                const checkAllSatisfactions = (satisfactionType) => {
                    const satisfactions = suggestions.value?.satisfaction?.[satisfactionType] || {};
                    const requiredCount = teamMembers.value.length - (satisfactionType === 'ceo' || satisfactionType === 'roles' || satisfactionType === 'hires' ? 1 : 0);
                    if (teamMembers.value.length > 1 && Object.keys(satisfactions).length === requiredCount) {
                        if (isCEO.value) { // Apenas o CEO processa
                            processSatisfactionResults(satisfactionType);
                        }
                    } else if (teamMembers.value.length <= 1 && isCEO.value) { // Caso de equipe com 1 pessoa
                         if (isCEO.value) {
                            processSatisfactionResults(satisfactionType);
                        }
                    }
                }

                watch(() => suggestions.value?.votes?.company, () => checkAllVotes('company'), { deep: true });
                watch(() => suggestions.value?.votes?.ceo, () => checkAllVotes('ceo'), { deep: true });
                watch(() => suggestions.value?.satisfaction?.ceo, () => checkAllSatisfactions('ceo'), { deep: true });
                // ... watches para outros tipos de satisfa√ß√£o ...

                // Fun√ß√µes e M√©todos
                const formatCurrency = (value) => {
                    return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);
                };

                const setupFirebase = () => {
                    if (!auth || !db) {
                        loadingMessage.ref = 'Falha na inicializa√ß√£o do Firebase.';
                        connected.ref = false;
                        return;
                    }

                    onAuthStateChanged(auth, async user => {
                        if (user) {
                            userId.value = user.uid;
                            connected.value = true;
                            await loadGameState();
                            setupListeners();
                        } else {
                            try {
                                await signInAnonymously(auth);
                            } catch (error) {
                                console.error("Anonymous sign-in failed:", error);
                                loadingMessage.value = 'Falha na autentica√ß√£o. Recarregue a p√°gina.';
                                connected.value = false;
                            }
                        }
                    });
                };
                
                const loadGameState = async () => {
                    const localData = JSON.parse(localStorage.getItem(`genesis-empresarial-session`));
                    if (localData && localData.playerName && localData.playerPassword) {
                        playerNameInput.value = localData.playerName;
                        playerPasswordInput.value = localData.playerPassword;
                        playerAuthenticated.value = true;

                        if (localData.teamId) {
                            await joinTeam(true); 
                        }
                    }
                    loading.value = false;
                };

                const logout = () => {
                    if (confirm("Voc√™ tem certeza que quer sair? Voc√™ precisar√° inserir seu nome e senha para acessar a plataforma novamente.")) {
                        resetLocalState();
                    }
                }

                const resetLocalState = () => {
                    localStorage.removeItem(`genesis-empresarial-session`);
                    if(teamListener) teamListener();
                    playerAuthenticated.value = false;
                    teamId.value = null;
                    teamName.value = '';
                    currentStep.value = 0;
                    userProfile.value = null;
                    answers.value = Array(questions.length).fill(null);
                    assignedRoles.value = {};
                    hiredCounts.value = {};
                    selectedCompanyForSuggestion.value = null;
                    teamMembers.value = [];
                    suggestions.value = {};
                    userSuggestion.value = {};
                    userVote.value = { company: null, ceo: null };
                    userSatisfactionInput.value = { ceo: null, roles: null, hires: null };
                    playerNameInput.value = '';
                    playerPasswordInput.value = '';
                }

                const setupListeners = () => {
                    const teamsCollection = collection(db, "apps", appId, "teams");
                    onSnapshot(teamsCollection, (snapshot) => {
                        allTeams.value = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    });

                    const gameControllerDoc = doc(db, "apps", appId, "controller", "game_state");
                    onSnapshot(gameControllerDoc, (doc) => {
                        if (doc.exists()) {
                            scoresVisible.value = doc.data().scoresVisible || false;
                        }
                    });
                };

                const accessPlatform = () => {
                    if (!playerNameInput.value.trim() || !playerPasswordInput.value.trim()) {
                        alert("Por favor, preencha seu nome e senha.");
                        return;
                    }
                    localStorage.setItem('genesis-empresarial-session', JSON.stringify({
                        playerName: playerNameInput.value.trim(),
                        playerPassword: playerPasswordInput.value.trim()
                    }));
                    playerAuthenticated.value = true;
                };
                
                 const syncWithTeam = async (newTeamId) => {
                    teamId.value = newTeamId;
                    if(teamListener) teamListener();

                    const docRef = doc(db, "apps", appId, "teams", teamId.value);
                    teamListener = onSnapshot(docRef, (docSnap) => {
                        if (docSnap.exists()) {
                            const data = docSnap.data();
                            teamName.value = data.name;
                            currentStep.value = data.currentStep || 0;
                            selectedCompanyForSuggestion.value = data.selectedCompany || null;
                            hiredCounts.value = data.hiredCounts || {};
                            assignedRoles.value = data.assignedRoles || {};
                            teamMembers.value = data.members || [];
                            suggestions.value = data.suggestions || {};
                            joinCodeDisplay.value = data.joinCode;
                            teamSatisfaction.value = data.teamSatisfaction || {};
                            finalReport.value = data.finalReport || null;
                            
                            const currentUserData = teamMembers.value.find(m => m.id === userId.value);
                            if (currentUserData && currentUserData.profile) {
                                userProfile.value = profiles[currentUserData.profile];
                            }
                        } else {
                            if (teamId.value) { 
                                alert("Sua equipe foi removida. O jogo ser√° reiniciado.");
                                resetLocalState();
                            }
                        }
                    });
                };


                const saveState = async (dataToSave) => {
                    if (!teamId.value) return;
                    try {
                        const docRef = doc(db, "apps", appId, "teams", teamId.value);
                        await setDoc(docRef, dataToSave, { merge: true });
                    } catch (error) {
                        console.error("Error saving state:", error);
                    }
                };

                const createTeam = async () => {
                    loading.value = true;
                    loadingMessage.value = "Criando equipe...";
                    const userName = playerNameInput.value;
                    const password = playerPasswordInput.value;
                    const joinCode = (Math.random().toString(36).substring(2, 6) + Math.random().toString(36).substring(2, 6)).substring(0, 4).toUpperCase();
                    
                    const teamData = {
                        name: teamNameInput.value.trim(), score: 0, currentStep: 1, joinCode: joinCode,
                        members: [{ id: userId.value, name: userName, password: password, profile: null }],
                        suggestions: { votes: { company: {}, ceo: {} }, satisfaction: { ceo: {}, roles: {}, hires: {} }, hires: {} }
                    };

                    try {
                        const docRef = await addDoc(collection(db, "apps", appId, "teams"), teamData);
                        await syncWithTeam(docRef.id);
                        localStorage.setItem('genesis-empresarial-session', JSON.stringify({ 
                            teamId: docRef.id, joinCode, playerName: userName, playerPassword: password 
                        }));
                    } catch (e) { console.error("Error creating team: ", e); alert("N√£o foi poss√≠vel criar a equipe.");
                    } finally { loading.value = false; }
                };

                const joinTeam = async (isRejoin = false) => {
                    // L√≥gica para entrar na equipe... (igual √† vers√£o anterior)
                };

                const calculateProfile = () => {
                    const counts = answers.value.reduce((acc, curr) => { (acc[curr] = (acc[curr] || 0) + 1); return acc; }, {});
                    const result = Object.keys(counts).reduce((a, b) => counts[a] > counts[b] ? a : b);
                    userProfile.value = profiles[result];
                };

                const confirmProfile = async () => {
                    const profileName = Object.keys(profiles).find(key => profiles[key].name === userProfile.value.name);
                    const updatedMembers = teamMembers.value.map(m => m.id === userId.value ? { ...m, profile: profileName } : m);
                    await saveState({ members: updatedMembers });
                };

                const advanceToCompanyVoting = () => saveState({ currentStep: 2 });
                
                const submitVote = (voteType) => {
                    const voteValue = userVote.value[voteType];
                    if (!voteValue) return;
                    const updatePath = `suggestions.votes.${voteType}.${userId.value}`;
                    saveState({ [updatePath]: voteValue });
                };

                const processVoteResults = async (voteType) => {
                    // L√≥gica complexa de processamento de votos, c√°lculo de pontos, re-vota√ß√£o etc.
                };

                const submitSatisfaction = (satisfactionType) => {
                     const satisfactionValue = userSatisfactionInput.value[satisfactionType];
                    if (!satisfactionValue) return;
                    const updatePath = `suggestions.satisfaction.${satisfactionType}.${userId.value}`;
                    saveState({ [updatePath]: satisfactionValue });
                };

                const processSatisfactionResults = async (satisfactionType) => {
                    // L√≥gica para calcular m√©dia de satisfa√ß√£o e avan√ßar
                };

                const getCeoName = () => {
                    const ceoId = assignedRoles.value['CEO'];
                    return teamMembers.value.find(m => m.id === ceoId)?.name || '...';
                };

                const getTeamSatisfactionEmoji = (type) => {
                    const avg = teamSatisfaction.value[type];
                    if (!avg) return { emoji: 'ü§î', color: 'text-gray-500' };
                    if (avg > 4) return { emoji: 'ü§©', color: 'text-green-500' };
                    if (avg > 3) return { emoji: 'üòä', color: 'text-lime-500' };
                    if (avg > 2) return { emoji: 'üòê', color: 'text-yellow-500' };
                    if (avg > 1) return { emoji: 'üòï', color: 'text-orange-500' };
                    return { emoji: 'üò°', color: 'text-red-500' };
                };
                
                // ... Outras fun√ß√µes de l√≥gica do jogo ...

                onMounted(() => {
                    setupFirebase();
                });

                return {
                    loading, loadingMessage, connected, isLoggedIn, playerAuthenticated,
                    accessPlatform, createTeam, joinTeam, logout,
                    playerNameInput, playerPasswordInput, teamNameInput, joinCodeInput,
                    currentStep, teamName, teamMembers, joinCodeDisplay,
                    questions, answers, userProfile, profiles,
                    calculateProfile, confirmProfile, currentUserProfileCompleted, allMembersHaveProfile,
                    advanceToCompanyVoting,
                    companies, userVote, submitVote, userVotedFor,
                    isCEO, getCeoName, userSatisfaction, userSatisfactionInput, submitSatisfaction, teamSatisfaction, getTeamSatisfactionEmoji,
                    //... resto das vari√°veis e fun√ß√µes
                }
            }
        }).mount('#app')
    </script>
</body>
</html>

